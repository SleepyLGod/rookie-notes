---
description: ä¸€äº›C++11/14/17å°ç‚¹
---

# ğŸ˜… Miscellaneous

### `long long int`

`long long int` å¹¶ä¸æ˜¯ C++11 æœ€å…ˆå¼•å…¥çš„ï¼Œå…¶å®æ—©åœ¨ C99ï¼Œ `long long int` å°±å·²ç»è¢«çº³å…¥ C æ ‡å‡†ä¸­ï¼Œæ‰€ä»¥å¤§éƒ¨åˆ†çš„ç¼–è¯‘å™¨æ—©å·²æ”¯æŒã€‚&#x20;

C++11 çš„å·¥ä½œåˆ™æ˜¯æ­£å¼æŠŠå®ƒçº³å…¥æ ‡å‡†åº“ï¼Œ è§„å®šäº†ä¸€ä¸ª `long long int` ç±»å‹è‡³å°‘å…·å¤‡ 64 ä½çš„æ¯”ç‰¹æ•°ã€‚

### noexcept çš„ä¿®é¥°å’Œæ“ä½œ

C++ ç›¸æ¯”äº C çš„ä¸€å¤§ä¼˜åŠ¿å°±åœ¨äº C++ æœ¬èº«å°±å®šä¹‰äº†ä¸€å¥—å®Œæ•´çš„å¼‚å¸¸å¤„ç†æœºåˆ¶ã€‚ ç„¶è€Œåœ¨ C++11 ä¹‹å‰ï¼Œå‡ ä¹æ²¡æœ‰äººå»ä½¿ç”¨åœ¨å‡½æ•°ååä¹¦å†™å¼‚å¸¸å£°æ˜è¡¨è¾¾å¼ï¼Œ ä» C++11 å¼€å§‹ï¼Œè¿™å¥—æœºåˆ¶è¢«å¼ƒç”¨ï¼Œæ‰€ä»¥æˆ‘ä»¬ä¸å»è®¨è®ºä¹Ÿä¸å»ä»‹ç»ä»¥å‰è¿™å¥—æœºåˆ¶æ˜¯å¦‚ä½•å·¥ä½œå¦‚ä½•ä½¿ç”¨ï¼Œ ä½ æ›´ä¸åº”è¯¥ä¸»åŠ¨å»äº†è§£å®ƒã€‚

C++11 å°†**å¼‚å¸¸çš„å£°æ˜**ç®€åŒ–ä¸ºä»¥ä¸‹ä¸¤ç§æƒ…å†µï¼š

1. å‡½æ•°å¯èƒ½æŠ›å‡ºä»»ä½•å¼‚å¸¸
2. å‡½æ•°ä¸èƒ½æŠ›å‡ºä»»ä½•å¼‚å¸¸

å¹¶ä½¿ç”¨ `noexcept` å¯¹è¿™ä¸¤ç§è¡Œä¸ºè¿›è¡Œé™åˆ¶ï¼Œä¾‹å¦‚ï¼š

`void may_throw(); // å¯èƒ½æŠ›å‡ºå¼‚å¸¸`&#x20;

`void no_throw() noexcept; // ä¸å¯èƒ½æŠ›å‡ºå¼‚å¸¸`

ä½¿ç”¨ `noexcept` ä¿®é¥°è¿‡çš„å‡½æ•°å¦‚æœæŠ›å‡ºå¼‚å¸¸ï¼Œç¼–è¯‘å™¨ä¼šä½¿ç”¨ `std::terminate()` æ¥ç«‹å³ç»ˆæ­¢ç¨‹åºè¿è¡Œã€‚

`noexcept` è¿˜èƒ½å¤Ÿåšæ“ä½œç¬¦ï¼Œç”¨äº**æ“ä½œä¸€ä¸ªè¡¨è¾¾å¼**ï¼Œå½“è¡¨è¾¾å¼æ— å¼‚å¸¸æ—¶ï¼Œè¿”å› `true`ï¼Œå¦åˆ™è¿”å› `false`ã€‚

```cpp
#include <iostream>  
void may_throw() {  
 throw true;  
}  
auto non_block_throw = []{  
 may_throw();  
};  
void no_throw() noexcept {  
 return;  
}

auto block_throw = []() noexcept {  
 no_throw();  
};  
int main()  
{  
 std::cout << std::boolalpha  
 << "may_throw() noexcept? " << noexcept(may_throw()) << std::endl  
 << "no_throw() noexcept? " << noexcept(no_throw()) << std::endl  
 << "lmay_throw() noexcept? " << noexcept(non_block_throw()) << std::endl  
 << "lno_throw() noexcept? " << noexcept(block_throw()) << std::endl;  
 return 0;  
}
```

`noexcept` ä¿®é¥°å®Œä¸€ä¸ªå‡½æ•°ä¹‹åèƒ½å¤Ÿèµ·åˆ°**å°é”å¼‚å¸¸æ‰©æ•£**çš„åŠŸæ•ˆï¼Œå¦‚æœå†…éƒ¨äº§ç”Ÿå¼‚å¸¸ï¼Œå¤–éƒ¨ä¹Ÿä¸ä¼šè§¦å‘ã€‚ä¾‹å¦‚ï¼š

```cpp
try {  
    may_throw();  
} catch (...) {  
    std::cout << "æ•è·å¼‚å¸¸, æ¥è‡ª may_throw()" << std::endl;  
}  
try {  
    non_block_throw();  
} catch (...) {  
    std::cout << "æ•è·å¼‚å¸¸, æ¥è‡ª non_block_throw()" << std::endl;  
}  
try {  
    block_throw();  // å‡½æ•°è¢«noexceptä¿®é¥°
} catch (...) {  
    std::cout << "æ•è·å¼‚å¸¸, æ¥è‡ª block_throw()" << std::endl;  
}  
```

æœ€ç»ˆè¾“å‡ºä¸ºï¼š

```
æ•è·å¼‚å¸¸, æ¥è‡ª may_throw()  
æ•è·å¼‚å¸¸, æ¥è‡ª non_block_throw()  
```

### å­—é¢é‡

#### åŸå§‹å­—ç¬¦ä¸²å­—é¢é‡

ä¼ ç»Ÿ C++ é‡Œé¢è¦ç¼–å†™ä¸€ä¸ªå……æ»¡ç‰¹æ®Šå­—ç¬¦çš„å­—ç¬¦ä¸²å…¶å®æ˜¯éå¸¸ç—›è‹¦çš„ä¸€ä»¶äº‹æƒ…ï¼Œ æ¯”å¦‚ä¸€ä¸ªåŒ…å« HTML æœ¬ä½“çš„å­—ç¬¦ä¸²éœ€è¦æ·»åŠ å¤§é‡çš„è½¬ä¹‰ç¬¦ï¼Œ ä¾‹å¦‚ä¸€ä¸ªWindows ä¸Šçš„æ–‡ä»¶è·¯å¾„ç»å¸¸ä¼šï¼š`C:\\File\\To\\Path`ã€‚

C++11 æä¾›äº†åŸå§‹å­—ç¬¦ä¸²å­—é¢é‡çš„å†™æ³•ï¼Œå¯ä»¥åœ¨ä¸€ä¸ªå­—ç¬¦ä¸²å‰æ–¹ä½¿ç”¨ <mark style="color:red;">**`R`**</mark> æ¥ä¿®é¥°è¿™ä¸ªå­—ç¬¦ä¸²ï¼Œ åŒæ—¶ï¼Œå°†åŸå§‹å­—ç¬¦ä¸²ä½¿ç”¨æ‹¬å·åŒ…è£¹ï¼Œä¾‹å¦‚ï¼š

```cpp
#include <iostream>  
#include <string>  
int main() {  
    std::string str = R"(C:\File\To\Path)";  
    std::cout << str << std::endl;  
    return 0;  
}  
```

#### è‡ªå®šä¹‰å­—é¢é‡

C++11 å¼•è¿›äº†è‡ªå®šä¹‰å­—é¢é‡çš„èƒ½åŠ›ï¼Œé€šè¿‡**é‡è½½åŒå¼•å·åç¼€è¿ç®—ç¬¦**å®ç°ï¼š

å­—ç¬¦ä¸²å­—é¢é‡è‡ªå®šä¹‰å¿…é¡»è®¾ç½®å¦‚ä¸‹çš„**å‚æ•°åˆ—è¡¨**

```cpp
std::string operator"" _wow1(const char *wow1, size_t len) {  
    return std::string(wow1) + "woooooooooow, amazing";  
}  
std::string operator"" _wow2 (unsigned long long i) {  
    return std::to_string(i) + "woooooooooow, amazing";  
}  
int main() {  
    auto str = "abc"_wow1;  
    auto num = 1_wow2;  
    std::cout << str << std::endl;  
    std::cout << num << std::endl;  
    return 0;  
}  
```

è‡ªå®šä¹‰å­—é¢é‡æ”¯æŒå››ç§å­—é¢é‡ï¼š

1. **æ•´å‹å­—é¢é‡**ï¼šé‡è½½æ—¶å¿…é¡»ä½¿ç”¨ `unsigned long long`ã€`const char *`ã€æ¨¡æ¿å­—é¢é‡ç®—ç¬¦å‚æ•°ï¼Œåœ¨ä¸Šé¢çš„ä»£ç ä¸­ä½¿ç”¨çš„æ˜¯å‰è€…ï¼›
2. **æµ®ç‚¹å‹å­—é¢é‡**ï¼šé‡è½½æ—¶å¿…é¡»ä½¿ç”¨ `long double`ã€`const char *`ã€æ¨¡æ¿å­—é¢é‡ç®—ç¬¦ï¼›
3. **å­—ç¬¦ä¸²å­—é¢é‡**ï¼šå¿…é¡»ä½¿ç”¨ `(const char *, size_t)` å½¢å¼çš„å‚æ•°è¡¨ï¼›
4. **å­—ç¬¦å­—é¢é‡**ï¼šå‚æ•°åªèƒ½æ˜¯ `char`, `wchar_t`, `char16_t`, `char32_t` è¿™å‡ ç§ç±»å‹ã€‚

### å†…å­˜å¯¹é½

C++ 11 å¼•å…¥äº†ä¸¤ä¸ªæ–°çš„å…³é”®å­— **`alignof`** å’Œ **`alignas`** æ¥æ”¯æŒå¯¹å†…å­˜å¯¹é½è¿›è¡Œæ§åˆ¶ã€‚ `alignof` å…³é”®å­—èƒ½å¤Ÿè·å¾—ä¸€ä¸ªä¸å¹³å°ç›¸å…³çš„ `std::size_t` ç±»å‹çš„å€¼ï¼Œç”¨äº**æŸ¥è¯¢**è¯¥å¹³å°çš„å¯¹é½æ–¹å¼ã€‚ å½“ç„¶æˆ‘ä»¬æœ‰æ—¶å€™å¹¶ä¸æ»¡è¶³äºæ­¤ï¼Œç”šè‡³å¸Œæœ›è‡ªå®šå®šä¹‰ç»“æ„çš„å¯¹é½æ–¹å¼ï¼ŒåŒæ ·ï¼ŒC++ 11 è¿˜å¼•å…¥äº† `alignas` æ¥**é‡æ–°ä¿®é¥°**æŸä¸ªç»“æ„çš„å¯¹é½æ–¹å¼ã€‚æˆ‘ä»¬æ¥çœ‹ä¸¤ä¸ªä¾‹å­ï¼š

```cpp
#include <iostream>  
struct Storage {  
    char      a;  
    int       b;  
    double    c;  
    long long d;  
};  
struct alignas(std::max_align_t) AlignasStorage {  
    char      a;  
    int       b;  
    double    c;  
    long long d;  
};  
int main() {  
    std::cout << alignof(Storage) << std::endl;  
    std::cout << alignof(AlignasStorage) << std::endl;  
    return 0;  
}  
```

å…¶ä¸­ `std::max_align_t` è¦æ±‚æ¯ä¸ªæ ‡é‡ç±»å‹çš„å¯¹é½æ–¹å¼ä¸¥æ ¼ä¸€æ ·ï¼Œå› æ­¤å®ƒå‡ ä¹æ˜¯æœ€å¤§æ ‡é‡æ²¡æœ‰å·®å¼‚ï¼Œ è¿›è€Œå¤§éƒ¨åˆ†å¹³å°ä¸Šå¾—åˆ°çš„ç»“æœä¸º `long double`ï¼Œå› æ­¤æˆ‘ä»¬è¿™é‡Œå¾—åˆ°çš„ `AlignasStorage` çš„å¯¹é½è¦æ±‚æ˜¯ 8 æˆ– 16ã€‚

### Cè‰¹11 çš„æ‰¬å¼ƒ

*   ä¸å†å…è®¸å­—ç¬¦ä¸²å­—é¢å€¼å¸¸é‡èµ‹å€¼ç»™ä¸€ä¸ª `char *`ã€‚å¦‚æœéœ€è¦ç”¨å­—ç¬¦ä¸²å­—é¢å€¼å¸¸é‡èµ‹å€¼å’Œåˆå§‹åŒ–ä¸€ä¸ª `char *`ï¼Œåº”è¯¥ä½¿ç”¨ `const char *` æˆ–è€… `auto`ã€‚

    ä¾‹å¦‚ï¼š

    ```
    char *str = "hello world!";  // å°†å‡ºç°å¼ƒç”¨è­¦å‘Š
    ```
* C++98 å¼‚å¸¸è¯´æ˜ã€ `unexpected_handler`ã€`set_unexpected()` ç­‰ç›¸å…³ç‰¹æ€§è¢«å¼ƒç”¨ï¼Œåº”è¯¥ä½¿ç”¨ `noexcept`ã€‚
* `auto_ptr` è¢«å¼ƒç”¨ã€‚
* `register` å…³é”®å­—è¢«å¼ƒç”¨ï¼Œå¯ä»¥ä½¿ç”¨ä½†ä¸å†å…·å¤‡ä»»ä½•å®é™…å«ä¹‰ã€‚
* `bool` ç±»å‹çš„ `++` æ“ä½œè¢«å¼ƒç”¨ã€‚
* å¦‚æœä¸€ä¸ªç±»æœ‰ææ„å‡½æ•°ï¼Œä¸ºå…¶ç”Ÿæˆæ‹·è´æ„é€ å‡½æ•°å’Œæ‹·è´èµ‹å€¼è¿ç®—ç¬¦çš„ç‰¹æ€§è¢«å¼ƒç”¨äº†ã€‚
* C è¯­è¨€é£æ ¼çš„ç±»å‹è½¬æ¢è¢«å¼ƒç”¨ï¼ˆå³åœ¨å˜é‡å‰ä½¿ç”¨ `(convert_type)`ï¼‰ï¼Œåº”è¯¥ä½¿ç”¨ `static_cast`ã€`reinterpret_cast`ã€`const_cast` æ¥è¿›è¡Œç±»å‹è½¬æ¢ã€‚
* ç‰¹åˆ«åœ°ï¼Œåœ¨æœ€æ–°çš„ C++17 æ ‡å‡†ä¸­å¼ƒç”¨äº†ä¸€äº›å¯ä»¥ä½¿ç”¨çš„ C æ ‡å‡†åº“ï¼Œä¾‹å¦‚ `<ccomplex>`ã€`<cstdalign>`ã€`<cstdbool>` ä¸ `<ctgmath>` ç­‰

### å¸¸é‡

#### nullptr

`nullptr` å‡ºç°çš„ç›®çš„æ˜¯ä¸ºäº†æ›¿ä»£ `NULL`ã€‚åœ¨æŸç§æ„ä¹‰ä¸Šæ¥è¯´ï¼Œä¼ ç»Ÿ C++ ä¼šæŠŠ `NULL`ã€`0` è§†ä¸ºåŒä¸€ç§ä¸œè¥¿ï¼Œè¿™å–å†³äºç¼–è¯‘å™¨å¦‚ä½•å®šä¹‰ `NULL`ï¼Œæœ‰äº›ç¼–è¯‘å™¨ä¼šå°† `NULL` å®šä¹‰ä¸º `((void*)0)`ï¼Œæœ‰äº›åˆ™ä¼šç›´æ¥å°†å…¶å®šä¹‰ä¸º `0`ã€‚

C++ **ä¸å…è®¸**ç›´æ¥å°† `void *` éšå¼è½¬æ¢åˆ°å…¶ä»–ç±»å‹ã€‚ä½†å¦‚æœç¼–è¯‘å™¨å°è¯•æŠŠ `NULL` å®šä¹‰ä¸º `((void*)0)`ï¼Œé‚£ä¹ˆåœ¨ä¸‹é¢è¿™å¥ä»£ç ä¸­ï¼š`char *ch = NULL;` ä¸­æ²¡æœ‰äº† `void *` éšå¼è½¬æ¢çš„ C++ åªå¥½å°† `NULL` å®šä¹‰ä¸º `0`ã€‚è€Œè¿™ä¾ç„¶ä¼šäº§ç”Ÿæ–°çš„é—®é¢˜ï¼Œå°† `NULL` å®šä¹‰æˆ `0` å°†å¯¼è‡´ `C++` ä¸­é‡è½½ç‰¹æ€§å‘ç”Ÿæ··ä¹±ã€‚

æ¯”å¦‚ `void f(char*)` å’Œ `void f(int)`ï¼Œ`f(NULL)` ä¼šè°ƒç”¨åè€…ã€‚

C++11 å¼•å…¥äº† `nullptr` å…³é”®å­—ï¼Œä¸“é—¨ç”¨æ¥åŒºåˆ†ç©ºæŒ‡é’ˆã€`0`ã€‚è€Œ `nullptr` çš„ç±»å‹ä¸º `nullptr_t`ï¼Œèƒ½å¤Ÿéšå¼çš„è½¬æ¢ä¸ºä»»ä½•æŒ‡é’ˆæˆ–æˆå‘˜æŒ‡é’ˆçš„ç±»å‹ï¼Œä¹Ÿèƒ½å’Œä»–ä»¬è¿›è¡Œç›¸ç­‰æˆ–è€…ä¸ç­‰çš„æ¯”è¾ƒã€‚

#### constexpr

å¦‚æœç¼–è¯‘å™¨èƒ½å¤Ÿåœ¨ç¼–è¯‘æ—¶å°±æŠŠ 1 + 2 ç±»ä¼¼çš„å¸¸é‡è¡¨è¾¾å¼ç›´æ¥ä¼˜åŒ–å¹¶æ¤å…¥åˆ°ç¨‹åºè¿è¡Œæ—¶ï¼Œå°†èƒ½å¢åŠ ç¨‹åºçš„æ€§èƒ½ã€‚

è¿™é‡Œæœ‰ä¸ªå°ğŸŒ°

```cpp
#include <iostream>
#define LEN 10 // const 

int len_foo() {
    int i = 2; 
    return i;
}

constexpr int len_foo_constexpr() {
    return 5; // 5 : const
}

constexpr int fibonacci(const int n) {
    return n == 1 || n == 2 ? 1 : fibonacci(n - 1) + fibonacci(n - 2);
}

int main() {
    char arr_1[10];                      // åˆæ³•
    char arr_2[LEN];                     // åˆæ³•

    int len = 10;
    // char arr_3[len];                  // éæ³•ï¼ï¼ï¼ï¼ï¼

    const int len_2 = len + 1;
    constexpr int len_2_constexpr = 1 + 2 + 3;
    // char arr_4[len_2];                // éæ³•ï¼ï¼ï¼ï¼ï¼
    char arr_4[len_2_constexpr];         // åˆæ³•

    // char arr_5[len_foo()+5];          // éæ³•ï¼ï¼ï¼ï¼ï¼
    char arr_6[len_foo_constexpr() + 1]; // åˆæ³• ğŸ¶

    std::cout << fibonacci(10) << std::endl;
    // 1, 1, 2, 3, 5, 8, 13, 21, 34, 55
    std::cout << fibonacci(10) << std::endl;
    return 0;
}
```

ä¸Šé¢çš„ä¾‹å­ä¸­ï¼Œ`char arr_4[len_2]` å¯èƒ½æ¯”è¾ƒä»¤äººå›°æƒ‘ï¼Œå› ä¸º `len_2` å·²ç»è¢«å®šä¹‰ä¸ºäº†å¸¸é‡ã€‚

**ä¸ºä»€ä¹ˆ `char arr_4[len_2]` ä»ç„¶æ˜¯éæ³•çš„å‘¢ï¼Ÿ**

è¿™æ˜¯å› ä¸º **C++ æ ‡å‡†ä¸­æ•°ç»„çš„é•¿åº¦å¿…é¡»æ˜¯ä¸€ä¸ªå¸¸é‡è¡¨è¾¾å¼**ï¼Œè€Œå¯¹äº `len_2` è€Œè¨€ï¼Œè¿™æ˜¯ä¸€ä¸ª `const` å¸¸æ•°ï¼Œè€Œä¸æ˜¯ä¸€ä¸ªå¸¸é‡è¡¨è¾¾å¼ï¼Œå› æ­¤ï¼ˆå³ä¾¿è¿™ç§è¡Œä¸ºåœ¨å¤§éƒ¨åˆ†ç¼–è¯‘å™¨ä¸­éƒ½æ”¯æŒï¼Œä½†æ˜¯ï¼‰å®ƒæ˜¯ä¸€ä¸ªéæ³•çš„è¡Œä¸ºï¼Œæˆ‘ä»¬éœ€è¦ä½¿ç”¨ C++11 å¼•å…¥çš„ `constexpr` ç‰¹æ€§æ¥è§£å†³è¿™ä¸ªé—®é¢˜ã€‚

**ã€** ä¸‹é¢è¯´è¯´å¸¸é‡å’Œå¸¸é‡è¡¨è¾¾å¼ï¼š

å¸¸é‡æ˜¯å›ºå®šå€¼ï¼Œåœ¨ç¨‹åºæ‰§è¡ŒæœŸé—´ä¸ä¼šæ”¹å˜ã€‚**å¸¸é‡è¡¨è¾¾å¼** å®šä¹‰èƒ½åœ¨**ç¼–è¯‘**æ—¶æ±‚å€¼çš„è¡¨è¾¾å¼ã€‚è¿™ç§è¡¨è¾¾å¼èƒ½ç”¨åšéç±»å‹æ¨¡æ¿å®å‚ã€æ•°ç»„å¤§å°ï¼Œå¹¶ç”¨äºå…¶ä»–è¦æ±‚å¸¸é‡è¡¨è¾¾å¼çš„è¯­å¢ƒã€‚

ä½†æ˜¯å¸¸é‡ä¸æ˜¯å¸¸é‡è¡¨è¾¾å¼ï¼Œåªæœ‰**ç”¨å¸¸é‡è¡¨è¾¾å¼åˆå§‹åŒ–çš„å¸¸é‡**ï¼Œæ‰èƒ½æˆä¸ºå¸¸é‡è¡¨è¾¾å¼ï¼Œ**ç”¨éå¸¸é‡è¡¨è¾¾å¼åˆå§‹åŒ–çš„å¸¸é‡**æ¯”å¦‚ä¸Šæ–‡çš„`len_2`ä»…ä»…æ˜¯å¸¸é‡ã€‚å¦‚æœå¸¸é‡çš„åˆå§‹å€¼ä¸æ˜¯å¸¸é‡è¡¨è¾¾å¼,åˆ™è¯¥å¸¸é‡ä¸æ˜¯å¸¸é‡è¡¨è¾¾å¼ã€‚

* å®šä¹‰ä¸€ä¸ªå¸¸é‡å˜é‡ï¼Œåªéœ€è¦æŠŠ`const`æ”¾åˆ°å˜é‡ç±»å‹çš„å‰é¢**æˆ–è€…åé¢**å°±å¯ä»¥äº†
* å®šä¹‰`const`å˜é‡è€Œä¸åˆå§‹åŒ–ä¼šå¯¼è‡´ç¼–è¯‘é”™è¯¯
* å¸¸é‡å˜é‡çš„åˆå§‹åŒ–å¯ä»¥æ¥è‡ªäºæ™®é€šå˜é‡
*   C++æœ‰ä¸¤ç§ç±»å‹åœ°å¸¸é‡ï¼šç¼–è¯‘æ—¶é—´å¸¸é‡å’Œè¿è¡Œæ—¶é—´å¸¸é‡ï¼š

    è¿è¡Œæ—¶é—´å¸¸é‡è¡¨ç¤ºåªæœ‰åœ¨ç¨‹åºè¿è¡Œçš„æ—¶å€™æ‰ä¼šåˆå§‹åŒ–ï¼Œç¼–è¯‘æ—¶é—´å¸¸é‡æ˜¯åœ¨ç¼–è¯‘æ—¶é—´å°±è¢«åˆå§‹åŒ–äº†ï¼›

    åœ¨å¤§å¤šæ•°åœºæ™¯ä¸‹ï¼Œç¼–è¯‘æ—¶é—´å¸¸é‡è¿˜æ˜¯è¿è¡Œæ—¶é—´å¸¸é‡æ˜¯å¯ä»¥äº’æ¢çš„ã€‚

    ç„¶è€Œåœ¨ä¸€äº›ç‰¹æ®Šåœºæ™¯ä¸‹ï¼ŒC++éœ€è¦ä¸€äº›ç¼–è¯‘æ—¶é—´å¸¸é‡ï¼Œä¸ºäº†ä½œå‡ºåŒºåˆ†ï¼ŒC++11æ–°å®šä¹‰äº†ä¸€ä¸ªå…³é”®å­—`constexpr`å®šä¹‰ç¼–è¯‘æ—¶é—´å¸¸é‡ã€‚

å†é¡ºä¾¿æä¸€å˜´ç¬¦å·å¸¸é‡:

åœ¨å¤šæ•°ç¨‹åºé‡Œï¼Œä¸€ä¸ªç¬¦å·å¸¸é‡éœ€è¦ä»å¤´ç”¨åˆ°å°¾ã€‚è¿™ç§åŒ…æ‹¬æ•°å­¦æˆ–è€…ç‰©ç†ä¸Šçš„ä¸€äº›å¸¸æ•°ã€‚ä¸å…¶æ¯æ¬¡éƒ½å®šä¹‰ä¸€éï¼Œæ¯”å¦‚ç›´æ¥åœ¨ä¸€ä¸ªæ ¸å¿ƒä½ç½®å®šä¹‰ä¸€æ¬¡ï¼Œå…¶ä»–åœ°æ–¹éšæ—¶ä½¿ç”¨ã€‚è¿™æ ·ï¼Œå¦‚æœä½ éœ€è¦æ”¹åŠ¨çš„è¯ï¼Œåªéœ€è¦æ”¹åŠ¨ä¸€ä¸ªåœ°æ–¹å°±OKäº†ã€‚

åœ¨C++é‡Œæœ‰å¾ˆå¤šç§æ–¹å¼æ¥å®ç°è¿™ä¸€ç‚¹ï¼Œä½†æ˜¯ä¸‹é¢çš„æ˜¯æœ€å®¹æ˜“çš„ï¼š

* åˆ›å»ºä¸€ä¸ªå¤´æ–‡ä»¶æ¥åŒ…å«è¿™äº›å¸¸é‡
* åœ¨è¿™ä¸ªå¤´æ–‡ä»¶é‡Œå®šä¹‰ä¸€ä¸ªå‘½åç©ºé—´
* åœ¨ä½ çš„å‘½åç©ºé—´é‡ŒåŠ ä¸Šä½ çš„æ‰€æœ‰å¸¸é‡
* å½“ä½ ä½¿ç”¨çš„æ—¶å€™#includeä½ çš„å¤´æ–‡ä»¶

```cpp
#ifndef CONSTANTS_H
#define CONSTANTS_H
 
// define your own namespace to hold constants
namespace constants {
    constexpr double pi(3.14159);
    constexpr double avogadro(6.0221413e23);
    constexpr double my_gravity(9.2); // m/s^2 -- gravity is light on this planet
    // ... other related constants
}
#endif
```

ä½¿ç”¨èŒƒå›´æ“ä½œç¬¦`::`æ¥å¼•ç”¨

```objectivec
#include "constants.h"
double circumference = 2 * radius * constants::pi;
```

å¦‚æœä½ åŒæ—¶æœ‰ç‰©ç†å­¦çš„å¸¸é‡å’Œappçš„è°ƒä¼˜å€¼ï¼Œä½ å¯ä»¥å¼„ä¸¤ä¸ªæ–‡ä»¶ã€‚ä¸€ä¸ªæ˜¯æ°¸è¿œä¸å˜çš„ç‰©ç†å¸¸é‡ï¼Œå¦ä¸€ä¸ªæ˜¯å¯èƒ½æœ‰å˜åŒ–çš„è°ƒä¼˜å€¼ã€‚è¿™æ ·ç‰©ç†å¸¸é‡ä½ å¯ä»¥åˆ°å¤„ä½¿ç”¨äº†ã€‚**ã€**

æ¥ä¸‹æ¥å›åˆ°ä¸Šé¢çš„å‡½æ•°ï¼š

è€Œå¯¹äº `arr_5` æ¥è¯´ï¼ŒC++98 ä¹‹å‰çš„ç¼–è¯‘å™¨æ— æ³•å¾—çŸ¥ `len_foo()` åœ¨è¿è¡ŒæœŸå®é™…ä¸Šæ˜¯è¿”å›ä¸€ä¸ªå¸¸æ•°ï¼Œè¿™ä¹Ÿå°±å¯¼è‡´äº†éæ³•çš„äº§ç”Ÿã€‚

C++11 æä¾›äº† `constexpr` è®©ç”¨æˆ·**æ˜¾å¼çš„å£°æ˜å‡½æ•°æˆ–å¯¹è±¡æ„é€ å‡½æ•°**åœ¨ç¼–è¯‘æœŸä¼šæˆä¸ºå¸¸é‡è¡¨è¾¾å¼ï¼Œè¿™ä¸ªå…³é”®å­—æ˜ç¡®çš„å‘Šè¯‰ç¼–è¯‘å™¨åº”è¯¥å»éªŒè¯ `len_foo` åœ¨ç¼–è¯‘æœŸå°±åº”è¯¥æ˜¯ä¸€ä¸ªå¸¸é‡è¡¨è¾¾å¼ã€‚

æ­¤å¤–ï¼Œ`constexpr` ä¿®é¥°çš„å‡½æ•°å¯ä»¥ä½¿ç”¨é€’å½’ã€‚

ä» C++**14** å¼€å§‹ï¼Œ`constexpr` å‡½æ•°å¯ä»¥**åœ¨å†…éƒ¨ä½¿ç”¨å±€éƒ¨å˜é‡ã€å¾ªç¯å’Œåˆ†æ”¯ç­‰ç®€å•è¯­å¥**ï¼Œä¾‹å¦‚ä¸‹é¢çš„ä»£ç åœ¨ C++**11** çš„æ ‡å‡†ä¸‹æ˜¯**ä¸èƒ½**å¤Ÿé€šè¿‡ç¼–è¯‘çš„ï¼šã€

```cpp
constexpr int fibonacci(const int n) {
    if(n == 1) return 1;
    if(n == 2) return 1;
    return fibonacci(n-1) + fibonacci(n-2);
}
```

ä¸ºæ­¤ï¼Œæˆ‘ä»¬å¯ä»¥å†™å‡ºä¸Šé¢çš„ç®€åŒ–çš„ç‰ˆæœ¬æ¥ä½¿å¾—å‡½æ•°ä» C++11 å¼€å§‹å³å¯ç”¨ã€‚

### å˜é‡

åœ¨ä¼ ç»Ÿ C++ ä¸­ï¼Œå˜é‡çš„å£°æ˜è™½ç„¶èƒ½å¤Ÿä½äºä»»ä½•ä½ç½®ï¼Œç”šè‡³äº `for` è¯­å¥å†…èƒ½å¤Ÿå£°æ˜ä¸€ä¸ªä¸´æ—¶å˜é‡ `int`ï¼Œä½†å§‹ç»ˆæ²¡æœ‰åŠæ³•åœ¨ `if` å’Œ `switch` è¯­å¥ä¸­å£°æ˜ä¸€ä¸ªä¸´æ—¶çš„å˜é‡ã€‚ä¾‹å¦‚ï¼š

```cpp
int main() {
    std::vector<int> vec = {1, 2, 3, 4};

    // åœ¨ c++17 ä¹‹å‰
    const std::vector<int>::iterator itr = std::find(vec.begin(), vec.end(), 2);
    if (itr != vec.end()) {
        *itr = 3;
    }

    // éœ€è¦é‡æ–°å®šä¹‰ä¸€ä¸ªæ–°çš„å˜é‡
    const std::vector<int>::iterator itr2 = std::find(vec.begin(), vec.end(), 3);
    if (itr2 != vec.end()) {
        *itr2 = 4;
    }

    // å°†è¾“å‡º 1, 4, 3, 4
    for (std::vector<int>::iterator element = vec.begin(); element != vec.end(); 
        ++element)
        std::cout << *element << std::endl;
}
```

åœ¨ä¸Šé¢çš„ä»£ç ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ° `itr` è¿™ä¸€å˜é‡æ˜¯å®šä¹‰åœ¨æ•´ä¸ª `main()` çš„ä½œç”¨åŸŸå†…çš„ï¼Œè¿™å¯¼è‡´å½“æˆ‘ä»¬éœ€è¦å†æ¬¡éå†æ•´ä¸ª `std::vectors` æ—¶ï¼Œéœ€è¦é‡æ–°å‘½åå¦ä¸€ä¸ªå˜é‡ã€‚

**C++17 æ¶ˆé™¤äº†è¿™ä¸€é™åˆ¶ï¼Œä½¿å¾—æˆ‘ä»¬å¯ä»¥åœ¨ `if`ï¼ˆæˆ– `switch`ï¼‰ä¸­å®Œæˆè¿™ä¸€æ“ä½œï¼š**

```cpp
// å°†ä¸´æ—¶å˜é‡æ”¾åˆ° if è¯­å¥å†…
if (const std::vector<int>::iterator itr = std::find(vec.begin(), vec.end(), 3);
    itr != vec.end()) {
    *itr = 4;
}
```

#### åˆå§‹åŒ–åˆ—è¡¨

æœ€å¸¸è§çš„å°±æ˜¯åœ¨å¯¹è±¡è¿›è¡Œåˆå§‹åŒ–æ—¶è¿›è¡Œä½¿ç”¨

ä¼ ç»Ÿ C++ ä¸­ï¼Œä¸åŒçš„å¯¹è±¡æœ‰ç€ä¸åŒçš„åˆå§‹åŒ–æ–¹æ³•ï¼Œä¾‹å¦‚æ™®é€šæ•°ç»„ã€ POD ï¼ˆ**P**lain **O**ld **D**ataï¼Œå³æ²¡æœ‰æ„é€ ã€ææ„å’Œè™šå‡½æ•°çš„ç±»æˆ–ç»“æ„ä½“ï¼‰ ç±»å‹éƒ½å¯ä»¥ä½¿ç”¨ `{}` è¿›è¡Œåˆå§‹åŒ–ï¼Œä¹Ÿå°±æ˜¯æˆ‘ä»¬æ‰€è¯´çš„åˆå§‹åŒ–åˆ—è¡¨ã€‚ è€Œå¯¹äºç±»å¯¹è±¡çš„åˆå§‹åŒ–ï¼Œè¦ä¹ˆéœ€è¦é€šè¿‡æ‹·è´æ„é€ ã€è¦ä¹ˆå°±éœ€è¦ä½¿ç”¨ `()` è¿›è¡Œã€‚ è¿™äº›ä¸åŒæ–¹æ³•éƒ½é’ˆå¯¹å„è‡ªå¯¹è±¡ï¼Œä¸èƒ½é€šç”¨ã€‚

ä¸ºè§£å†³è¿™ä¸ªé—®é¢˜ï¼ŒC++11 é¦–å…ˆæŠŠåˆå§‹åŒ–åˆ—è¡¨çš„æ¦‚å¿µç»‘å®šåˆ°ç±»å‹ä¸Šï¼Œç§°å…¶ä¸º <mark style="color:green;background-color:green;">`std::initializer_list`</mark>ï¼Œå…è®¸æ„é€ å‡½æ•°æˆ–å…¶ä»–å‡½æ•°åƒå‚æ•°ä¸€æ ·ä½¿ç”¨åˆå§‹åŒ–åˆ—è¡¨ï¼Œè¿™å°±ä¸º**ç±»å¯¹è±¡çš„åˆå§‹åŒ–ä¸æ™®é€šæ•°ç»„å’Œ POD çš„åˆå§‹åŒ–**æ–¹æ³•æä¾›äº†ç»Ÿä¸€çš„æ¡¥æ¢ï¼Œä¾‹å¦‚ï¼š

```cpp
#include <initializer_list>
#include <vector>
#include <iostream>

class MagicFoo {
public:
    std::vector<int> vec;
    MagicFoo(std::initializer_list<int> list) {
        for (std::initialozer_list<int>::iterator it = list.begin();
             it != list.end(); ++it) {
            vec.push_back(*it);
        }
    }
};
int main() {
    // after C++11
    MagicFoo magicFoo = {1, 2, 3, 4, 5};

    std::cout << "magicFoo: ";
    for (std::vector<int>::iterator it = magicFoo.vec.begin(); 
        it != magicFoo.vec.end(); ++it) {
        std::cout << *it << std::endl;
    }
}
```

è¿™ç§æ„é€ å‡½æ•°è¢«å«åšåˆå§‹åŒ–åˆ—è¡¨æ„é€ å‡½æ•°ï¼Œå…·æœ‰è¿™ç§æ„é€ å‡½æ•°çš„ç±»å‹å°†åœ¨åˆå§‹åŒ–æ—¶è¢«ç‰¹æ®Šå…³ç…§ã€‚

åˆå§‹åŒ–åˆ—è¡¨é™¤äº†ç”¨åœ¨å¯¹è±¡æ„é€ ä¸Šï¼Œè¿˜èƒ½å°†å…¶ä½œä¸ºæ™®é€šå‡½æ•°çš„å½¢å‚ï¼Œä¾‹å¦‚ï¼š

```cpp
public:
    void foo(std::initializer_list<int> list) {
        for (std::initializer_list<int>::iterator it = list.begin();
            it != list.end(); ++it) {
            vec.push_back(*it);
        }
    }

magicFoo.foo({6,7,8,9});
```

å…¶æ¬¡ï¼ŒC++11 è¿˜æä¾›äº†ç»Ÿä¸€çš„è¯­æ³•æ¥åˆå§‹åŒ–ä»»æ„çš„å¯¹è±¡ï¼Œä¾‹å¦‚ï¼š

```
Foo foo2 {3, 4};
```

#### ç»“æ„åŒ–ç»‘å®š

ç»“æ„åŒ–ç»‘å®šæä¾›äº†ç±»ä¼¼å…¶ä»–è¯­è¨€ä¸­æä¾›çš„å¤šè¿”å›å€¼çš„åŠŸèƒ½ã€‚C++11 æ–°å¢äº† `std::tuple` å®¹å™¨ç”¨äºæ„é€ ä¸€ä¸ªå…ƒç»„ï¼Œè¿›è€Œå›Šæ‹¬å¤šä¸ªè¿”å›å€¼ã€‚ä½†ç¼ºé™·æ˜¯ï¼ŒC++11/14 å¹¶æ²¡æœ‰æä¾›ä¸€ç§ç®€å•çš„æ–¹æ³•ç›´æ¥ä»å…ƒç»„ä¸­æ‹¿åˆ°å¹¶å®šä¹‰å…ƒç»„ä¸­çš„å…ƒç´ ï¼Œå°½ç®¡æˆ‘ä»¬å¯ä»¥ä½¿ç”¨ `std::tie` å¯¹å…ƒç»„è¿›è¡Œæ‹†åŒ…ï¼Œä½†æˆ‘ä»¬ä¾ç„¶å¿…é¡»éå¸¸æ¸…æ¥šè¿™ä¸ªå…ƒç»„åŒ…å«å¤šå°‘ä¸ªå¯¹è±¡ï¼Œå„ä¸ªå¯¹è±¡æ˜¯ä»€ä¹ˆç±»å‹ï¼Œéå¸¸éº»çƒ¦ã€‚

C++**17** å®Œå–„äº†è¿™ä¸€è®¾å®šï¼Œç»™å‡ºçš„ç»“æ„åŒ–ç»‘å®šå¯ä»¥è®©æˆ‘ä»¬å†™å‡ºè¿™æ ·çš„ä»£ç ï¼š

```cpp
#include <iostream>
#include <tuple>

std::tuple<int, double, std::string> f() {
    return std::make_tuple(1, 2.3, "456");
}

int main() {
    auto [x, y, z] = f();
    std::cout << x << ", " << y << ", " << z << std::endl;
    return 0;
}
```

### ç±»å‹æ¨å¯¼

C++11 å¼•å…¥äº† `auto` å’Œ `decltype` è¿™ä¸¤ä¸ªå…³é”®å­—å®ç°äº†ç±»å‹æ¨å¯¼ï¼Œè®©ç¼–è¯‘å™¨æ¥æ“å¿ƒå˜é‡çš„ç±»å‹ã€‚

è¿™ä½¿å¾— C++ ä¹Ÿå…·æœ‰äº†å’Œå…¶ä»–ç°ä»£ç¼–ç¨‹è¯­è¨€ä¸€æ ·ï¼ŒæŸç§æ„ä¹‰ä¸Šæä¾›äº†æ— éœ€æ“å¿ƒå˜é‡ç±»å‹çš„ä½¿ç”¨ä¹ æƒ¯ã€‚

#### auto

`auto` åœ¨å¾ˆæ—©ä»¥å‰å°±å·²ç»è¿›å…¥äº† C++ï¼Œä½†æ˜¯ä»–å§‹ç»ˆä½œä¸ºä¸€ä¸ªå­˜å‚¨ç±»å‹çš„æŒ‡ç¤ºç¬¦å­˜åœ¨ï¼Œä¸ `register` å¹¶å­˜ã€‚åœ¨ä¼ ç»Ÿ C++ ä¸­ï¼Œå¦‚æœä¸€ä¸ªå˜é‡æ²¡æœ‰å£°æ˜ä¸º `register` å˜é‡ï¼Œå°†è‡ªåŠ¨è¢«è§†ä¸ºä¸€ä¸ª `auto` å˜é‡ã€‚è€Œéšç€ `register` è¢«å¼ƒç”¨ï¼ˆåœ¨ C++17 ä¸­ä½œä¸ºä¿ç•™å…³é”®å­—ï¼Œä»¥åä½¿ç”¨ï¼Œç›®å‰ä¸å…·å¤‡å®é™…æ„ä¹‰ï¼‰ï¼Œå¯¹ `auto` çš„è¯­ä¹‰å˜æ›´ä¹Ÿå°±éå¸¸è‡ªç„¶äº†ã€‚

ä½¿ç”¨ `auto` è¿›è¡Œç±»å‹æ¨å¯¼çš„ä¸€ä¸ªæœ€ä¸ºå¸¸è§è€Œä¸”æ˜¾è‘—çš„ä¾‹å­å°±æ˜¯è¿­ä»£å™¨ã€‚ä½ åº”è¯¥åœ¨å‰é¢çš„å°èŠ‚é‡Œçœ‹åˆ°äº†ä¼ ç»Ÿ C++ ä¸­å†—é•¿çš„è¿­ä»£å†™æ³•ï¼š

```cpp
// åœ¨ C++11 ä¹‹å‰
// ç”±äº cbegin() å°†è¿”å› vector<int>::const_iterator
// æ‰€ä»¥ itr ä¹Ÿåº”è¯¥æ˜¯ vector<int>::const_iterator ç±»å‹
for(vector<int>::const_iterator it = vec.cbegin(); itr != vec.cend(); ++it)
```

è€Œæœ‰äº† `auto` ä¹‹åå¯ä»¥ï¼š

```cpp
class MagicFoo {
public:
    std::vector<int> vec;
    MagicFoo(std::initializer_list<int> list) {
        // ä» C++11 èµ·, ä½¿ç”¨ auto å…³é”®å­—è¿›è¡Œç±»å‹æ¨å¯¼
        for (auto it = list.begin(); it != list.end(); ++it) {
            vec.push_back(*it);
        }
    }
};
int main() {
    MagicFoo magicFoo = {1, 2, 3, 4, 5};
    std::cout << "magicFoo: ";
    for (auto it = magicFoo.vec.begin(); it != magicFoo.vec.end(); ++it) {
        std::cout << *it << ", ";
    }
    std::cout << std::endl;
    return 0;
}
```

ä¸€äº›å…¶ä»–çš„å¸¸è§ç”¨æ³•ï¼š

```cpp
auto i = 5;              // i è¢«æ¨å¯¼ä¸º int
auto arr = new auto(10); // arr è¢«æ¨å¯¼ä¸º int *
```

ä» **C++ 20** èµ·ï¼Œ`auto` ç”šè‡³èƒ½ç”¨äºå‡½æ•°ä¼ å‚ï¼Œè€ƒè™‘ä¸‹é¢çš„ä¾‹å­ï¼š

```cpp
int add(auto x, auto y) {
    return x+y;
}

auto i = 5; // è¢«æ¨å¯¼ä¸º int
auto j = 6; // è¢«æ¨å¯¼ä¸º int
std::cout << add(i, j) << std::endl;

```

**æ³¨æ„**ï¼š`auto` è¿˜ä¸èƒ½ç”¨äºæ¨å¯¼æ•°ç»„ç±»å‹ï¼š

```cpp
auto auto_arr2[10] = {arr}; // é”™è¯¯, æ— æ³•æ¨å¯¼æ•°ç»„å…ƒç´ ç±»å‹
```

#### decltype(auto)

`decltype(auto)` æ˜¯ C++14 å¼€å§‹æä¾›çš„ä¸€ä¸ªç•¥å¾®å¤æ‚çš„ç”¨æ³•ã€‚

ç®€å•æ¥è¯´ï¼Œ`decltype(auto)` ä¸»è¦ç”¨äºå¯¹è½¬å‘å‡½æ•°æˆ–å°è£…çš„è¿”å›ç±»å‹è¿›è¡Œæ¨å¯¼ï¼Œå®ƒä½¿æˆ‘ä»¬æ— éœ€æ˜¾å¼çš„æŒ‡å®š `decltype` çš„å‚æ•°è¡¨è¾¾å¼ã€‚è€ƒè™‘çœ‹ä¸‹é¢çš„ä¾‹å­ï¼Œå½“æˆ‘ä»¬éœ€è¦å¯¹ä¸‹é¢ä¸¤ä¸ªå‡½æ•°è¿›è¡Œå°è£…æ—¶ï¼š

```cpp
std::string  lookup1();
std::string& lookup2();
```

åœ¨ C++11 ä¸­ï¼Œå°è£…å®ç°æ˜¯å¦‚ä¸‹å½¢å¼ï¼š

```cpp
std::string look_up_a_string_1() {
    return lookup1();
}
std::string& look_up_a_string_2() {
    return lookup2();
}
```

è€Œæœ‰äº† `decltype(auto)`ï¼Œæˆ‘ä»¬å¯ä»¥è®©ç¼–è¯‘å™¨å®Œæˆè¿™ä¸€ä»¶çƒ¦äººçš„å‚æ•°è½¬å‘ï¼š

```cpp
decltype(auto) look_up_a_string_1() {
    return lookup1();
}
decltype(auto) look_up_a_string_2() {
    return lookup2();
}
```

### æ§åˆ¶æµ

#### if constexpr

&#x20;C++11 å¼•å…¥äº† `constexpr` å…³é”®å­—ï¼Œå®ƒå°†è¡¨è¾¾å¼æˆ–å‡½æ•°ç¼–è¯‘ä¸ºå¸¸é‡ç»“æœã€‚ä¸€ä¸ªå¾ˆè‡ªç„¶çš„æƒ³æ³•æ˜¯ï¼Œå¦‚æœæˆ‘ä»¬æŠŠè¿™ä¸€ç‰¹æ€§å¼•å…¥åˆ°æ¡ä»¶åˆ¤æ–­ä¸­å»ï¼Œè®©ä»£ç åœ¨ç¼–è¯‘æ—¶å°±å®Œæˆåˆ†æ”¯åˆ¤æ–­ï¼Œå²‚ä¸æ˜¯èƒ½è®©ç¨‹åºæ•ˆç‡æ›´é«˜ï¼Ÿ

**C++17** å°† `constexpr` è¿™ä¸ªå…³é”®å­—å¼•å…¥åˆ° `if` è¯­å¥ä¸­ï¼Œ**å…è®¸åœ¨ä»£ç ä¸­å£°æ˜å¸¸é‡è¡¨è¾¾å¼çš„åˆ¤æ–­æ¡ä»¶**ï¼Œè€ƒè™‘ä¸‹é¢çš„ä»£ç ï¼š

```cpp
template<typename T>
auto print_type_info(const T& t) {
    if constexpr (std::is_integral<T>::value) {
        return t + 1;
    } else {
         return t + 0.01;
    }
}
int main() {
    std::cout << print_type_info(5) << std::endl;
    std::cout << print_type_info(3.14) << std::endl;
}

// åœ¨ç¼–è¯‘æ—¶ï¼Œå®é™…ä»£ç å°±ä¼šè¡¨ç°ä¸ºå¦‚ä¸‹ï¼š
/*
int print_type_info(const int& t) {
    return t + 1;
}
double print_type_info(const double& t) {
    return t + 0.001;
}
int main() {
    std::cout << print_type_info(5) << std::endl;
    std::cout << print_type_info(3.14) << std::endl;
}
*/
```

#### åŒºé—´forè¿­ä»£

**C++11** å¼•å…¥äº†åŸºäºèŒƒå›´çš„è¿­ä»£å†™æ³•

```cpp
int main() {
    std::vector<int> vec = {1, 2, 3, 4};
    if (auto itr = std::find(vec.begin(), vec.end(), 3); itr != vec.end()) {
        *itr = 4;
    }
    for (auto element : vec)
        std::cout << element << std::endl; // read only
    for (auto &element : vec) {
        element += 1;                      // writeable
    }    
}
```

### template

#### å¤–éƒ¨æ¨¡æ¿

ä¼ ç»Ÿ C++ ä¸­ï¼Œæ¨¡æ¿åªæœ‰åœ¨ä½¿ç”¨æ—¶æ‰ä¼šè¢«ç¼–è¯‘å™¨å®ä¾‹åŒ–ã€‚

æ¢å¥è¯è¯´ï¼Œåªè¦åœ¨æ¯ä¸ªç¼–è¯‘å•å…ƒï¼ˆæ–‡ä»¶ï¼‰ä¸­ç¼–è¯‘çš„ä»£ç ä¸­é‡åˆ°äº†è¢«å®Œæ•´å®šä¹‰çš„æ¨¡æ¿ï¼Œéƒ½ä¼šå®ä¾‹åŒ–ã€‚è¿™å°±äº§ç”Ÿäº†é‡å¤å®ä¾‹åŒ–è€Œå¯¼è‡´çš„ç¼–è¯‘æ—¶é—´çš„å¢åŠ ã€‚å¹¶ä¸”ï¼Œæˆ‘ä»¬æ²¡æœ‰åŠæ³•é€šçŸ¥ç¼–è¯‘å™¨ä¸è¦è§¦å‘æ¨¡æ¿çš„å®ä¾‹åŒ–ã€‚

ä¸ºæ­¤ï¼Œ**C++11** å¼•å…¥äº†å¤–éƒ¨æ¨¡æ¿ï¼Œæ‰©å……äº†åŸæ¥çš„å¼ºåˆ¶ç¼–è¯‘å™¨åœ¨ç‰¹å®šä½ç½®å®ä¾‹åŒ–æ¨¡æ¿çš„è¯­æ³•ï¼Œä½¿æˆ‘ä»¬èƒ½å¤Ÿæ˜¾å¼çš„é€šçŸ¥ç¼–è¯‘å™¨**ä½•æ—¶è¿›è¡Œæ¨¡æ¿çš„å®ä¾‹åŒ–**ï¼š

```cpp
template class std::vector<bool>; // å¼ºè¡Œå®ä¾‹åŒ–
extern template class std::vector<double>; // ä¸åœ¨è¯¥å½“å‰ç¼–è¯‘æ–‡ä»¶ä¸­å®ä¾‹åŒ–æ¨¡æ¿ 
```

#### å°–æ‹¬å· ">"

ä¼ ç»Ÿ C++ çš„ç¼–è¯‘å™¨ä¸­ï¼Œ`>>`ä¸€å¾‹è¢«å½“åšå³ç§»è¿ç®—ç¬¦æ¥è¿›è¡Œå¤„ç†ã€‚ä½†å®é™…ä¸Šæˆ‘ä»¬å¾ˆå®¹æ˜“å°±å†™å‡ºäº†åµŒå¥—æ¨¡æ¿çš„ä»£ç ï¼š`std::vector<std::vector<int>> matrix;` åœ¨ä¼ ç»ŸC++ä¸­ä¸èƒ½ç¼–è¯‘

C++11 å¼€å§‹ï¼Œè¿ç»­çš„å³å°–æ‹¬å·å°†å˜å¾—åˆæ³•ï¼Œå¹¶ä¸”èƒ½å¤Ÿé¡ºåˆ©é€šè¿‡ç¼–è¯‘ã€‚ç”šè‡³äºåƒä¸‹é¢è¿™ç§å†™æ³•éƒ½èƒ½å¤Ÿé€šè¿‡ç¼–è¯‘ï¼š

```cpp
template<bool T>
class MType {
    bool m = T;
}
int main() {
 ...
 std::vector<MType(1>2)>> m; // åˆæ³•, ä½†ä¸å»ºè®®å†™å‡ºè¿™æ ·çš„ä»£ç 
```

#### ç±»å‹åˆ«åæ¨¡æ¿

ä»”ç»†ä½“ä¼šè¿™å¥è¯ï¼š**æ¨¡æ¿æ˜¯ç”¨æ¥äº§ç”Ÿç±»å‹çš„ã€‚**

åœ¨ä¼ ç»Ÿ C++ ä¸­ï¼Œ`typedef` å¯ä»¥ä¸ºç±»å‹å®šä¹‰ä¸€ä¸ªæ–°çš„åç§°ï¼Œä½†æ˜¯å´æ²¡æœ‰åŠæ³•ä¸ºæ¨¡æ¿å®šä¹‰ä¸€ä¸ªæ–°çš„åç§°ã€‚å› ä¸ºï¼Œæ¨¡æ¿ä¸æ˜¯ç±»å‹ã€‚ä¾‹å¦‚ï¼š

```cpp
template<typename T, typename U>
class MagicType {
public:
    T dark;
    U magic;
};

// ä¸åˆæ³•
template<typename T>
typedef MagicType<std::vector<T>, std::string> FakeDarkMagic;
```

**C++11** ä½¿ç”¨ `using` å¼•å…¥äº†ä¸‹é¢è¿™ç§å½¢å¼çš„å†™æ³•ï¼Œå¹¶ä¸”åŒæ—¶æ”¯æŒå¯¹ä¼ ç»Ÿ `typedef` ç›¸åŒçš„åŠŸæ•ˆï¼š

é€šå¸¸æˆ‘ä»¬ä½¿ç”¨ `typedef` å®šä¹‰åˆ«åçš„è¯­æ³•æ˜¯ï¼š`typedef åŸåç§° æ–°åç§°;`ï¼Œä½†æ˜¯å¯¹å‡½æ•°æŒ‡é’ˆç­‰åˆ«åçš„å®šä¹‰è¯­æ³•å´ä¸ç›¸åŒï¼Œè¿™é€šå¸¸ç»™ç›´æ¥é˜…è¯»é€ æˆäº†ä¸€å®šç¨‹åº¦çš„å›°éš¾ã€‚

```cpp
template<typename T, typename U>
class MagicType {
public:
    T dark;
    U magic;
};

// 1st
typedef int (*process)(void *);
using NewProcess = int(*)(void *);

// 2nd
template<typename T>
using TrueMagic = MagicType<std::vector<T>, std::string>;
int main() {
    TrueMagic<bool> you;
}    
```

#### å˜é•¿å‚æ•°æ¨¡æ¿

åœ¨ C++11 ä¹‹å‰ï¼Œæ— è®ºæ˜¯ç±»æ¨¡æ¿è¿˜æ˜¯å‡½æ•°æ¨¡æ¿ï¼Œéƒ½åªèƒ½æŒ‰å…¶æŒ‡å®šçš„æ ·å­ï¼Œ æ¥å—ä¸€ç»„å›ºå®šæ•°é‡çš„æ¨¡æ¿å‚æ•°ï¼›

è€Œ C++11 åŠ å…¥äº†æ–°çš„è¡¨ç¤ºæ–¹æ³•ï¼Œ å…è®¸ä»»æ„ä¸ªæ•°ã€ä»»æ„ç±»åˆ«çš„æ¨¡æ¿å‚æ•°ï¼ŒåŒæ—¶ä¹Ÿä¸éœ€è¦åœ¨å®šä¹‰æ—¶å°†å‚æ•°çš„ä¸ªæ•°å›ºå®šã€‚

```cpp
template<typename... Ts> class Magic;
```

æ¨¡æ¿ç±» Magic çš„å¯¹è±¡ï¼Œèƒ½å¤Ÿæ¥å—ä¸å—é™åˆ¶ä¸ªæ•°çš„ `typename` ä½œä¸ºæ¨¡æ¿çš„å½¢å¼å‚æ•°ï¼Œä¾‹å¦‚ä¸‹é¢çš„å®šä¹‰ï¼š

```cpp
class Magic<int, 
            std::vector<int>, 
            std::map<std::string, std::vector<int>>> darkMagic;
```

æ—¢ç„¶æ˜¯ä»»æ„å½¢å¼ï¼Œæ‰€ä»¥ä¸ªæ•°ä¸º `0` çš„æ¨¡æ¿å‚æ•°ä¹Ÿæ˜¯å¯ä»¥çš„ï¼š`class Magic<> nothing;`ã€‚

å¦‚æœä¸å¸Œæœ›äº§ç”Ÿçš„æ¨¡æ¿å‚æ•°ä¸ªæ•°ä¸º `0`ï¼Œå¯ä»¥æ‰‹åŠ¨çš„å®šä¹‰è‡³å°‘ä¸€ä¸ªæ¨¡æ¿å‚æ•°ï¼š

```cpp
template<typename Require, typename... Args> class Magic2;
```

å˜é•¿å‚æ•°æ¨¡æ¿ä¹Ÿèƒ½è¢«ç›´æ¥è°ƒæ•´åˆ°åˆ°æ¨¡æ¿å‡½æ•°ä¸Šã€‚

ä¼ ç»Ÿ C ä¸­çš„ `printf` å‡½æ•°ï¼Œ è™½ç„¶ä¹Ÿèƒ½è¾¾æˆä¸å®šä¸ªæ•°çš„å½¢å‚çš„è°ƒç”¨ï¼Œä½†å…¶å¹¶éç±»åˆ«å®‰å…¨ã€‚ è€Œ C++11 é™¤äº†èƒ½å®šä¹‰ç±»åˆ«å®‰å…¨çš„å˜é•¿å‚æ•°å‡½æ•°å¤–ï¼Œ è¿˜å¯ä»¥ä½¿ç±»ä¼¼ `printf` çš„å‡½æ•°èƒ½è‡ªç„¶åœ°å¤„ç†éè‡ªå¸¦ç±»åˆ«çš„å¯¹è±¡ã€‚ é™¤äº†åœ¨æ¨¡æ¿å‚æ•°ä¸­èƒ½ä½¿ç”¨ `...` è¡¨ç¤ºä¸å®šé•¿æ¨¡æ¿å‚æ•°å¤–ï¼Œ **å‡½æ•°å‚æ•°**ä¹Ÿä½¿ç”¨åŒæ ·çš„è¡¨ç¤ºæ³•ä»£è¡¨ä¸å®šé•¿å‚æ•°ï¼Œ è¿™ä¹Ÿå°±ä¸ºæˆ‘ä»¬ç®€å•ç¼–å†™å˜é•¿å‚æ•°å‡½æ•°æä¾›äº†ä¾¿æ·çš„æ‰‹æ®µï¼Œä¾‹å¦‚ï¼š

```cpp
template<typename... Args> 
void printf(const std::string &str, Arg... args);
```

é‚£ä¹ˆæˆ‘ä»¬å®šä¹‰äº†å˜é•¿çš„æ¨¡æ¿å‚æ•°ï¼Œå¦‚ä½•å¯¹å‚æ•°è¿›è¡Œè§£åŒ…å‘¢ï¼Ÿ

é¦–å…ˆï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ `sizeof...` æ¥è®¡ç®—å‚æ•°çš„ä¸ªæ•°ï¼Œï¼š

```cpp
template<typename... Args>
void magic(Args... args) {
    std::cout << sizeof...(args) << std::endl;
}
```

æˆ‘ä»¬å¯ä»¥ä¼ é€’ä»»æ„ä¸ªå‚æ•°ç»™ `magic` å‡½æ•°ï¼š

å…¶æ¬¡ï¼Œå¯¹å‚æ•°è¿›è¡Œè§£åŒ…ï¼Œåˆ°ç›®å‰ä¸ºæ­¢è¿˜æ²¡æœ‰ä¸€ç§ç®€å•çš„æ–¹æ³•èƒ½å¤Ÿå¤„ç†å‚æ•°åŒ…ï¼Œä½†æœ‰ä¸¤ç§ç»å…¸çš„å¤„ç†æ‰‹æ³•ï¼š

**1. é€’å½’æ¨¡æ¿å‡½æ•°**

é€’å½’æ˜¯éå¸¸å®¹æ˜“æƒ³åˆ°çš„ä¸€ç§æ‰‹æ®µï¼Œä¹Ÿæ˜¯æœ€ç»å…¸çš„å¤„ç†æ–¹æ³•ã€‚è¿™ç§æ–¹æ³•ä¸æ–­**é€’å½’åœ°å‘å‡½æ•°ä¼ é€’æ¨¡æ¿å‚æ•°**ï¼Œè¿›è€Œè¾¾åˆ°é€’å½’éå†æ‰€æœ‰æ¨¡æ¿å‚æ•°çš„ç›®çš„ï¼š

```cpp
template<typename T0>
void printf0(T0 value) { // å•å‚æ•°â€”â€”é€’å½’æœ€åä¸€æ­¥
    std::cout << value << std::endl;
}
template<typename T, typename... Ts>
void printf0(T value, Ts... args) { // å¤šå‚æ•°â€”â€”é€’å½’å¼€å§‹
    std::cout << value << std::endl;
    printf0(args...);
}
int main() {
    printf0(1, 2, "123", 1.1);
    return 0;
}
```

**2. å˜å‚æ¨¡æ¿å±•å¼€**

ä½ åº”è¯¥æ„Ÿå—åˆ°äº†è¿™å¾ˆç¹çï¼Œåœ¨ C++17 ä¸­å¢åŠ äº†å˜å‚æ¨¡æ¿å±•å¼€çš„æ”¯æŒï¼Œäºæ˜¯ä½ å¯ä»¥åœ¨ä¸€ä¸ªå‡½æ•°ä¸­å®Œæˆ `printf` çš„ç¼–å†™ï¼š

```cpp
template<typename T0, typename... Ts>
void printf1(T0 t0, Ts... t) {
    std::cout << t0 << std::endl;
    if constexpr (sizeof...(t) > 0) {
        printf1(t...);
    }
}
```

äº‹å®ä¸Šï¼Œæœ‰æ—¶å€™æˆ‘ä»¬è™½ç„¶ä½¿ç”¨äº†å˜å‚æ¨¡æ¿ï¼Œå´ä¸ä¸€å®šéœ€è¦å¯¹å‚æ•°åšé€ä¸ªéå†ï¼Œ

æˆ‘ä»¬å¯ä»¥åˆ©ç”¨ **`std::bind`** åŠå®Œç¾è½¬å‘ç­‰ç‰¹æ€§å®ç°å¯¹å‡½æ•°å’Œå‚æ•°çš„ç»‘å®šï¼Œä»è€Œè¾¾åˆ°æˆåŠŸè°ƒç”¨çš„ç›®çš„ã€‚

**3. åˆå§‹åŒ–åˆ—è¡¨å±•å¼€**

é€’å½’æ¨¡æ¿å‡½æ•°æ˜¯ä¸€ç§æ ‡å‡†çš„åšæ³•ï¼Œä½†ç¼ºç‚¹æ˜¾è€Œæ˜“è§çš„åœ¨äºå¿…é¡»å®šä¹‰ä¸€ä¸ªç»ˆæ­¢é€’å½’çš„å‡½æ•°ã€‚

è¿™é‡Œä»‹ç»ä¸€ç§ä½¿ç”¨åˆå§‹åŒ–åˆ—è¡¨å±•å¼€çš„é»‘é­”æ³•ï¼š

```cpp
template<typename T, typename... Ts>
auto printf2(T value, Ts... args) {
    std::cout << value << std::endl;
    (void) std::initializer_list<T> { ( [&args] {
        std::cout << args << std::endl;
    }(), value)...};
}
```

åœ¨è¿™ä¸ªä»£ç ä¸­ï¼Œé¢å¤–ä½¿ç”¨äº† C++11 ä¸­æä¾›çš„åˆå§‹åŒ–åˆ—è¡¨ä»¥åŠ Lambda è¡¨è¾¾å¼çš„ç‰¹æ€§ï¼ˆä¸‹ä¸€èŠ‚ä¸­å°†æåˆ°ï¼‰ã€‚

é€šè¿‡åˆå§‹åŒ–åˆ—è¡¨ï¼Œ`(lambda è¡¨è¾¾å¼, value)...` å°†ä¼šè¢«å±•å¼€ã€‚

ç”±äºé€—å·è¡¨è¾¾å¼çš„å‡ºç°ï¼Œé¦–å…ˆä¼šæ‰§è¡Œå‰é¢çš„ lambda è¡¨è¾¾å¼ï¼Œå®Œæˆå‚æ•°çš„è¾“å‡ºã€‚&#x20;

ä¸ºäº†é¿å…ç¼–è¯‘å™¨è­¦å‘Šï¼Œæˆ‘ä»¬å¯ä»¥å°† `std::initializer_list` æ˜¾å¼çš„è½¬ä¸º `void`ã€‚

#### æŠ˜å è¡¨è¾¾å¼

**C++ 17** ä¸­å°†å˜é•¿å‚æ•°è¿™ç§ç‰¹æ€§è¿›ä¸€æ­¥å¸¦ç»™äº†è¡¨è¾¾å¼ï¼Œè€ƒè™‘ä¸‹é¢è¿™ä¸ªä¾‹å­ï¼š

```cpp
template<typename ... T>
auto sum(T ... t) {
    return (t + ...);
}
int main() {
    std::cout << sum(1, 2, 3, 4, 5, 6, 7, 8, 9, 10) << std::endl;
}
```

#### éç±»å‹æ¨¡æ¿å‚æ•°æ¨å¯¼

å‰é¢æˆ‘ä»¬ä¸»è¦æåŠçš„æ˜¯æ¨¡æ¿å‚æ•°çš„ä¸€ç§å½¢å¼ï¼šç±»å‹æ¨¡æ¿å‚æ•°ã€‚

```cpp
template <typename T, typename U>
auto add(T t, U u) {
    return t+u;
}
```

å…¶ä¸­æ¨¡æ¿çš„å‚æ•° `T` å’Œ `U` ä¸ºå…·ä½“çš„ç±»å‹ã€‚&#x20;

ä½†è¿˜æœ‰ä¸€ç§å¸¸è§æ¨¡æ¿å‚æ•°å½¢å¼å¯ä»¥è®©**ä¸åŒå­—é¢é‡æˆä¸ºæ¨¡æ¿å‚æ•°**ï¼Œå³éç±»å‹æ¨¡æ¿å‚æ•°ï¼š

```cpp
template<typename T, int BufSize>
class buffer_t {
public:
    T& alloc();
    void free(T& item);
private:
    T data[BufSize];
}
buffer_t<int, 100> buf;
```

åœ¨è¿™ç§æ¨¡æ¿å‚æ•°å½¢å¼ä¸‹ï¼Œæˆ‘ä»¬å¯ä»¥å°† `100` ä½œä¸ºæ¨¡æ¿çš„å‚æ•°è¿›è¡Œä¼ é€’ã€‚&#x20;

åœ¨ **C++11** å¼•å…¥äº†ç±»å‹æ¨å¯¼è¿™ä¸€ç‰¹æ€§åï¼Œæˆ‘ä»¬ä¼šå¾ˆè‡ªç„¶çš„é—®ï¼Œæ—¢ç„¶æ­¤å¤„çš„æ¨¡æ¿å‚æ•° ä»¥å…·ä½“çš„å­—é¢é‡è¿›è¡Œä¼ é€’ï¼Œèƒ½å¦è®©ç¼–è¯‘å™¨è¾…åŠ©æˆ‘ä»¬è¿›è¡Œç±»å‹æ¨å¯¼ï¼Œ é€šè¿‡ä½¿ç”¨å ä½ç¬¦ `auto` ä»è€Œä¸å†éœ€è¦æ˜ç¡®æŒ‡æ˜ç±»å‹ï¼Ÿ&#x20;

å¹¸è¿çš„æ˜¯ï¼Œ**C++17** å¼•å…¥äº†è¿™ä¸€ç‰¹æ€§ï¼Œæˆ‘ä»¬çš„ç¡®å¯ä»¥ `auto` å…³é”®å­—ï¼Œè®©ç¼–è¯‘å™¨è¾…åŠ©å®Œæˆå…·ä½“ç±»å‹çš„æ¨å¯¼ï¼Œ ä¾‹å¦‚ï¼š

```cpp
template <auto value> 
void foo() {
    std::cout << value << std::endl;
    return;
}

int main() {
    foo<10>();  // value è¢«æ¨å¯¼ä¸º int ç±»å‹
}
```

### é¢å‘å¯¹è±¡

#### å§”æ‰˜æ„é€ 

C++11 å¼•å…¥äº†å§”æ‰˜æ„é€ çš„æ¦‚å¿µï¼Œè¿™ä½¿å¾—å¯ä»¥**åœ¨åŒä¸€ä¸ªç±»ä¸­ä¸€ä¸ªæ„é€ å‡½æ•°è°ƒç”¨å¦ä¸€ä¸ªæ„é€ å‡½æ•°**ï¼Œä»è€Œè¾¾åˆ°ç®€åŒ–ä»£ç çš„ç›®çš„ï¼š

```cpp
class Base {
public:
    int value1;
    int value2;
    Base() {
        value1 = 1;
    }
    Base(int value) : Base() { // å§”æ‰˜ Base() æ„é€ å‡½æ•°
        value2 = value;
    }
};
```

#### ç»§æ‰¿æ„é€ 

ä¼ ç»Ÿ C++ ä¸­ï¼Œæ„é€ å‡½æ•°å¦‚æœéœ€è¦ç»§æ‰¿æ˜¯éœ€è¦å°†å‚æ•°ä¸€ä¸€ä¼ é€’çš„ï¼Œè¿™å°†å¯¼è‡´æ•ˆç‡ä½ä¸‹ã€‚C++11 åˆ©ç”¨å…³é”®å­— `using` å¼•å…¥äº†ç»§æ‰¿æ„é€ å‡½æ•°çš„æ¦‚å¿µï¼š

```cpp
class Base {
public:
    int value1;
    int value2;
    Base() {
        value1 = 1;
    }
    Base(int value) : Base() {
        value2 = value;
    }
};
class SubClass : public Base {
public:
    using Base::Base;
};

int main() {
    ...
    SubBase s(3);
    ...
}
```

#### æ˜¾å¼















